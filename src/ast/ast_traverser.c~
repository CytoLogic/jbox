/* File generated by the BNF Converter (bnfc 2.9.6.1). */

/*** Visitor Traversal Skeleton. ***/
/* This traverses the abstract syntax tree.
   To use, copy ast_traverser.h and Skeleton.c to
   new files. */

#include <stdlib.h>
#include <stdio.h>
#include <wordexp.h> 

#include "ast_traverser.h"
#include "jbox_debug.h"

void visitListJob(ListJob listjob)
{
  DPRINT("visiting ListJob");
  while(listjob  != 0)
  {
    /* Code For ListJob Goes Here */
    visitJob(listjob->job_);
    listjob = listjob->listjob_;
  }
}

void visitListShellToken(ListShellToken listshelltoken)
{
  DPRINT("visiting ListShellToken");
  while(listshelltoken  != 0)
  {
    /* Code For ListShellToken Goes Here */
    visitShellToken(listshelltoken->shelltoken_);
    listshelltoken = listshelltoken->listshelltoken_;
  }
}

void visitInput(Input p)
{
  DPRINT("visiting_Input");
  switch(p->kind)
  {
  case is_In:
    /* Code for In Goes Here */
    visitListJob(p->u.in_.listjob_);
    break;

  default:
    fprintf(stderr, "Error: bad kind field when printing Input!\n");
    exit(1);
  }
}

void visitJob(Job p)
{
  DPRINT("visiting Job");
  switch(p->kind)
  {
  case is_AssigJob:
    /* Code for AssigJob Goes Here */
    DPRINT("is AssigJob");
    visitWordToken(p->u.assigJob_.wordtoken_);
    visitCommandLine(p->u.assigJob_.commandline_);
    break;
  case is_AIChatJob:
    /* Code for AIChatJob Goes Here */
    DPRINT("is AIChatJob");
    visitAIQueryToken(p->u.aIChatJob_.aiquerytoken_);
    break;
  case is_AIExecJob:
    /* Code for AIExecJob Goes Here */
    DPRINT("is AIExecJob");
    visitAIExecToken(p->u.aIExecJob_.aiexectoken_);
    break;
  case is_FGJob:
    /* Code for FGJob Goes Here */
    DPRINT("is FGJob");
    visitCommandLine(p->u.fGJob_.commandline_);
    break;
  case is_BGJob:
    /* Code for BGJob Goes Here */
    DPRINT("is BGJob");
    visitCommandLine(p->u.bGJob_.commandline_);
    break;

  default:
    fprintf(stderr, "Error: bad kind field when printing Job!\n");
    exit(1);
  }
}

void visitCommandLine(CommandLine p)
{
  DPRINT("visiting CommandLine");
  switch(p->kind)
  {
  case is_CmdLine:
    /* Code for CmdLine Goes Here */
    visitCommandPart(p->u.cmdLine_.commandpart_);
    visitOptionalInputRedirection(p->u.cmdLine_.optionalinputredirection_);
    visitOptionalOutputRedirection(p->u.cmdLine_.optionaloutputredirection_);
    break;

  default:
    fprintf(stderr, "Error: bad kind field when printing CommandLine!\n");
    exit(1);
  }
}

void visitCommandPart(CommandPart p)
{
  DPRINT("visiting CommandPart");
  switch(p->kind)
  {
  case is_SnglCmd:
    /* Code for SnglCmd Goes Here */
    DPRINT("is SnglCmd");
    visitCommandUnit(p->u.snglCmd_.commandunit_);
    break;
  case is_PipeCmd:
    /* Code for PipeCmd Goes Here */
    DPRINT("is PipeCmd");
    visitCommandUnit(p->u.pipeCmd_.commandunit_);
    visitCommandPart(p->u.pipeCmd_.commandpart_);
    break;

  default:
    fprintf(stderr, "Error: bad kind field when printing CommandPart!\n");
    exit(1);
  }
}

void visitCommandUnit(CommandUnit p)
{
  DPRINT("visiting CommandUnit");
  switch(p->kind)
  {
  case is_CmdUnit:
    /* Code for CmdUnit Goes Here */
    visitListShellToken(p->u.cmdUnit_.listshelltoken_);
    break;

  default:
    fprintf(stderr, "Error: bad kind field when printing CommandUnit!\n");
    exit(1);
  }
}

void visitOptionalInputRedirection(OptionalInputRedirection p)
{
  DPRINT("visiting OptionalInputRedirection");
  switch(p->kind)
  {
  case is_NoInRedir:
    /* Code for NoInRedir Goes Here */
    DPRINT("is NoInRedir");
    break;
  case is_InRedir:
    /* Code for InRedir Goes Here */
    DPRINT("is InRedir");
    visitShellToken(p->u.inRedir_.shelltoken_);
    break;

  default:
    fprintf(stderr, "Error: bad kind field when printing OptionalInputRedirection!\n");
    exit(1);
  }
}

void visitOptionalOutputRedirection(OptionalOutputRedirection p)
{
  DPRINT("visiting OptionalOutputRedirection");
  switch(p->kind)
  {
  case is_NoOutRedir:
    /* Code for NoOutRedir Goes Here */
    DPRINT("is NoOutRedir");
    break;
  case is_OutRedir:
    /* Code for OutRedir Goes Here */
    DPRINT("is OutRedir");
    visitShellToken(p->u.outRedir_.shelltoken_);
    break;

  default:
    fprintf(stderr, "Error: bad kind field when printing OptionalOutputRedirection!\n");
    exit(1);
  }
}

char* visitShellToken(ShellToken p)
{
  DPRINT("visiting ShellToken");

  wordexp_t exp_result;

  switch(p->kind)
  {
  case is_Var:
    /* Code for Var Goes Here */
    visitVariableToken(p->u.var_.variabletoken_);
    break;
  case is_Wrd:
    /* Code for Wrd Goes Here */
    visitWordToken(p->u.wrd_.wordtoken_);
    break;
  case is_Str:
    /* Code for Str Goes Here */
    visitStringToken(p->u.str_.stringtoken_);
    break;

  default:
    fprintf(stderr, "Error: bad kind field when printing ShellToken!\n");
    exit(1);
  }
}

void visitAIQueryToken(AIQueryToken p)
{
  DPRINT("visiting AIQueryToken");
  /* Code for AIQueryToken Goes Here */
}
void visitAIExecToken(AIExecToken p)
{
  DPRINT("visiting AIExecToken");
  /* Code for AIExecToken Goes Here */
}
int visitWordToken(WordToken p)
{
  DPRINT("visiting WordToken");
  // return the word
  char* word = strdup(p->u.wrd_.wordtoken_);
  DPRINT("word: %s", word);
  return word;
}
int visitStringToken(StringToken p)
{
  DPRINT("visiting StringToken");
  // return the string with variable substitution
  //TODO: add non-substitution strings ''
  visitStringToken(p->u.str_.stringtoken_);
  return strdup("");
}
int visitVariableToken(VariableToken p)
{
  DPRINT("visiting VariableToken");
  DPRINT("var_name: %s", p);
  char* env_value = getenv(p + 1); //skip '$'
  DPRINT("env_value: %s", env_value);
  return env_value ? strdup(env_value) : strdup("");
}

// TODO: trim fat
void visitIdent(Ident i)
{
  /* Code for Ident Goes Here */
}
void visitInteger(Integer i)
{
  /* Code for Integer Goes Here */
}
void visitDouble(Double d)
{
  /* Code for Double Goes Here */
}
void visitChar(Char c)
{
  /* Code for Char Goes Here */
}
void visitString(String s)
{
  /* Code for String Goes Here */
}

